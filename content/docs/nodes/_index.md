---
title: "Ноды"
description: "Типы нод сети Sigil Gate и базовая настройка безопасности"
summary: "Типы узлов сети, их роли и общие требования к безопасности"
weight: 20
---

{{< lead >}}
Сеть **Sigil Gate** состоит из нод трех типов: [Root]({{< ref "docs/nodes/root" >}}), [Core]({{< ref "docs/nodes/core" >}}) и [Entry]({{< ref "docs/nodes/entry" >}}). Каждая нода плоскости данных (Core и Entry) проходит стандартную процедуру начальной настройки безопасности перед вводом в эксплуатацию.
{{< /lead >}}

## Типы нод

{{< mermaid >}}
graph TD
    Root["Root-нода<br/><small>управление, PKI</small>"]
    Core["Core-нода<br/><small>ядро, маршрутизация</small>"]
    Entry["Entry-нода<br/><small>периферия, прием подключений</small>"]
    Client["Клиент<br/><small>устройство пользователя</small>"]

    Root -->|"SSH"| Core
    Root -->|"SSH"| Entry
    Client -->|"VLESS + gRPC"| Entry
    Entry -->|"VLESS + gRPC"| Core

    style Root fill:#7c3aed,color:#fff,stroke:#6d28d9
    style Core fill:#1d4ed8,color:#fff,stroke:#1e40af
    style Entry fill:#0891b2,color:#fff,stroke:#0e7490
    style Client fill:#64748b,color:#fff,stroke:#475569
{{< /mermaid >}}

| Тип | Плоскость | Расположение | Жизненный цикл |
|-----|-----------|-------------|----------------|
| [Root-нода]({{< ref "docs/nodes/root" >}}) | Управление | Любой сегмент | Долгоживущая, критическая |
| [Core-нода]({{< ref "docs/nodes/core" >}}) | Данные + управление | Вне региона | Долгоживущая |
| [Entry-нода]({{< ref "docs/nodes/entry" >}}) | Данные | Внутри региона | Расходная, ротируемая |
| [Клиент]({{< ref "docs/nodes/client" >}}) | Данные | Внутри региона | — |

## Базовая настройка безопасности

Каждая нода плоскости данных (Core и Entry) перед вводом в эксплуатацию проходит стандартную процедуру hardening. Цель — минимизировать поверхность атаки и обеспечить безопасное удаленное управление.

### Требования к серверу

| Параметр | Минимум |
|----------|---------|
| ОС | Debian 12 / Ubuntu 22.04 |
| RAM | 512 MB |
| Диск | 10 GB SSD |
| Сеть | Выделенный IPv4, открытый порт 22 |

### Этапы настройки

Настройка выполняется последовательно с Root-ноды (или другого управляющего сервера) и состоит из семи этапов:

{{< mermaid >}}
graph TD
    S1["1. Проверка доступа"]
    S2["2. Обновление системы"]
    S3["3. Создание сервисного пользователя"]
    S4["4. Размещение SSH-ключа"]
    S5["5. Проверка доступа по ключу"]
    S6["6. Защита SSH"]
    S7["7. Настройка firewall"]

    S1 --> S2 --> S3 --> S4 --> S5 --> S6 --> S7

    style S1 fill:#1e40af,color:#fff,stroke:#1d4ed8
    style S2 fill:#1e40af,color:#fff,stroke:#1d4ed8
    style S3 fill:#1e40af,color:#fff,stroke:#1d4ed8
    style S4 fill:#1e40af,color:#fff,stroke:#1d4ed8
    style S5 fill:#1e40af,color:#fff,stroke:#1d4ed8
    style S6 fill:#7c3aed,color:#fff,stroke:#6d28d9
    style S7 fill:#7c3aed,color:#fff,stroke:#6d28d9
{{< /mermaid >}}

#### 1. Проверка доступа

Проверка сетевой доступности сервера и SSH-авторизации root по паролю. На этом этапе собирается диагностика: версия ОС, объем RAM, дисковое пространство.

#### 2. Обновление системы

- Полное обновление пакетов (`apt update && apt upgrade`).
- Установка базовых зависимостей: `sudo`, `curl`, `wget`, `ufw`, `cron`.
- Настройка автоматического обновления безопасности (ежедневно).

#### 3. Создание сервисного пользователя

Создание непривилегированного пользователя с правами `sudo`. Вся дальнейшая работа с нодой выполняется от имени этого пользователя, а не от root.

#### 4. Размещение SSH-ключа

Публичный SSH-ключ управляющего сервера размещается в `~/.ssh/authorized_keys` сервисного пользователя. Права на директорию и файл устанавливаются в соответствии со стандартами OpenSSH (700/600).

#### 5. Проверка доступа по ключу

Верификация: сервисный пользователь может подключиться по SSH-ключу без пароля и выполнять команды через `sudo`.

{{< alert >}}
Этот этап **обязателен** перед переходом к защите SSH. Если доступ по ключу не работает — после отключения парольной авторизации доступ к серверу будет потерян.
{{< /alert >}}

#### 6. Защита SSH

Применение трех ключевых настроек `sshd_config`:

| Параметр | Значение | Назначение |
|----------|----------|------------|
| `PermitRootLogin` | `no` | Запрет входа root |
| `PasswordAuthentication` | `no` | Запрет авторизации по паролю |
| `PubkeyAuthentication` | `yes` | Авторизация только по ключу |

После применения доступ к серверу возможен **только** по SSH-ключу для сервисного пользователя.

#### 7. Настройка firewall

Настройка UFW (Uncomplicated Firewall):

| Правило | Описание |
|---------|----------|
| По умолчанию | Запрет всех входящих соединений |
| Порт 22 | SSH — удаленное управление |
| Порт 80 | HTTP — перенаправление на HTTPS |
| Порт 443 | HTTPS — основной рабочий порт |

### Модель SSH-доступа

Для разграничения привилегий используются отдельные SSH-ключи для разных уровней доступа:

{{< mermaid >}}
graph TD
    RootKey["Ключ Root-ноды"]
    CoreKey["Ключ Core-ноды"]

    Core["Core-ноды"]
    Entry["Entry-ноды"]

    RootKey -->|"полный доступ"| Core
    RootKey -->|"полный доступ"| Entry
    CoreKey -->|"управление"| Entry

    style RootKey fill:#7c3aed,color:#fff,stroke:#6d28d9
    style CoreKey fill:#1d4ed8,color:#fff,stroke:#1e40af
    style Core fill:#1d4ed8,color:#fff,stroke:#1e40af
    style Entry fill:#0891b2,color:#fff,stroke:#0e7490
{{< /mermaid >}}

| Ключ | Доступ | Назначение |
|------|--------|------------|
| Ключ Root-ноды | Все ноды (Core + Entry) | Полное администрирование сети |
| Ключ Core-ноды | Entry-ноды | Управление привязанными Entry-нодами |

### Результат настройки

После прохождения всех этапов нода готова к установке специфичных компонентов (Nginx, Xray-core, сайт-прикрытие):

- система обновлена, установлены базовые пакеты;
- настроено автоматическое обновление безопасности;
- создан сервисный пользователь с правами sudo;
- SSH-доступ — только по ключу, вход root отключен;
- firewall разрешает только порты 22, 80, 443.
