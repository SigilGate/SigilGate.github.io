---
title: "Итоговая Архитектура: Гибридный Подход"
---

# 02 Итоговая Архитектура: Гибридный Подход

Для удовлетворения всех требований по распределенному хранению, отказоустойчивости, консистентности, автоматизации и, главное, сохранности данных при полном перестроении сети Sigil Gate, была выбрана **гибридная архитектура**. Она сочетает в себе преимущества **распределенного Key-Value (KV) хранилища** для оперативных данных и **системы контроля версий Git** как основного источника истины и средства восстановления.

## 1. Обзор Гибридной Архитектуры

Этот подход разделяет функции хранения данных на две основные категории:

*   **Оперативное хранение (KV-хранилище):** Обеспечивает высокую доступность и строгую консистентность текущего состояния сети в реальном времени. Используется для быстрого чтения и записи конфигураций, статусов и оперативных параметров.
*   **Долгосрочное хранение и источник истины (Git-репозиторий):** Служит единственным достоверным источником желаемого состояния всей сети. Гарантирует версионирование, аудит изменений и возможность полного восстановления инфраструктуры с нуля.

### Диаграмма взаимодействия (высокоуровневая)

```mermaid
graph TD
    GitRepo[Приватный Git-репозиторий<br/><small>Источник истины, версионирование, бэкап</small>]
    KVStore[Распределенный KV-кластер<br/><small>Оперативные данные, высокая доступность, консистентность</small>]
    RootNode[Root-нода<br/><small>Развертывание, PKI, инциденты, синхронизация</small>]
    CoreNodes[Core-ноды<br/><small>Оперативное управление, синхронизация, хостинг KV-кластера</small>]
    EntryNodes[Entry-ноды<br/><small>Чтение конфигураций</small>]
    Automation[Автоматизация<br/><small>(CLI/API)</small>]

    GitRepo -- "Пуш/Пулл изменений" --> CoreNodes
    GitRepo -- "Пуш/Пулл изменений" --> RootNode

    CoreNodes -- "Чтение/Запись" --> KVStore
    RootNode -- "Чтение/Запись" --> KVStore
    EntryNodes -- "Чтение" --> KVStore

    Automation -- "Управление" --> CoreNodes
    Automation -- "Управление" --> RootNode
```

## 2. Ключевые Принципы Архитектуры

*   **Распределенность и Отказоустойчивость:** KV-кластер, размещенный на Core-нодах, обеспечивает распределенное хранение и устойчивость к отказу отдельных узлов. Сеть продолжает работать, пока есть как минимум одна Core-нода и одна Entry-нода, способные взаимодействовать с KV-кластером.
*   **Иерархия Управления:** Root-нода сохраняет высший уровень контроля, отвечая за развертывание и реагирование на инциденты. Core-ноды получают полномочия для оперативного управления (ротация, управление параметрами, пользователи), взаимодействуя с KV-хранилищем.
*   **Автоматизация:** Благодаря API KV-хранилища и четкой структуре данных, все управленческие функции могут быть полностью автоматизированы и реализованы через CLI или будущие веб-интерфейсы.
*   **Сохранность Данных:** Git-репозиторий гарантирует, что желаемое состояние сети всегда сохранено и может быть использовано для полного восстановления даже после катастрофического сбоя, уничтожившего все оперативные узлы и KV-кластер.
*   **Консистентность:** Распределенное KV-хранилище (например, `etcd`) обеспечивает строгую консистентность оперативных данных, а механизмы синхронизации поддерживают согласованность между KV и Git.

Подробное описание каждого компонента и механизмов их взаимодействия представлено в следующих разделах.