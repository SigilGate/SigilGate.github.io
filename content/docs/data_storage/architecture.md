---
title: "Архитектура"
description: "Гибридная архитектура хранения данных: KV-кластер + Git-репозиторий"
summary: "Выбор архитектуры: рассмотренные альтернативы и итоговый гибридный подход"
weight: 10
---

{{< lead >}}
Гибридная архитектура сочетает распределенное KV-хранилище для оперативных данных и Git-репозиторий как источник истины и средство восстановления.
{{< /lead >}}

## Рассмотренные альтернативы

| Подход | Причина отклонения |
|--------|--------------------|
| Файловая система на каждом узле | Нет консистентности, сложная синхронизация, ненадежное восстановление |
| Реляционные БД (PostgreSQL) | Избыточность для KV-данных, сложность развертывания распределенного кластера |
| Облачные БД (DynamoDB и др.) | Зависимость от провайдера, риски конфиденциальности, стоимость |

Ни один подход в чистом виде не удовлетворяет всем требованиям — в первую очередь, по сохранности данных при полном перестроении сети. Это привело к выбору гибридной архитектуры.

## Гибридный подход

Функции хранения разделены на два слоя:

| Слой | Компонент | Назначение |
|------|-----------|------------|
| Оперативный | [KV-кластер]({{< ref "docs/data_storage/kv_cluster" >}}) (etcd) | Текущее состояние сети, быстрое чтение/запись, строгая консистентность |
| Долгосрочный | [Git-репозиторий]({{< ref "docs/data_storage/git_repository" >}}) | Желаемое состояние, версионирование, аудит, восстановление с нуля |

{{< mermaid >}}
graph TD
    Git["Git-репозиторий<br/><small>источник истины</small>"]
    KV["KV-кластер<br/><small>оперативные данные</small>"]
    Root["Root-нода"]
    Core["Core-ноды"]
    Entry["Entry-ноды"]

    Git -->|"пуш / пулл"| Root
    Git -->|"пуш / пулл"| Core

    Root -->|"чтение / запись"| KV
    Core -->|"чтение / запись"| KV
    Entry -->|"чтение"| KV

    style Git fill:#374151,color:#fff,stroke:#1f2937
    style KV fill:#374151,color:#fff,stroke:#1f2937
    style Root fill:#7c3aed,color:#fff,stroke:#6d28d9
    style Core fill:#1d4ed8,color:#fff,stroke:#1e40af
    style Entry fill:#0891b2,color:#fff,stroke:#0e7490
{{< /mermaid >}}

## Ключевые принципы

- **Распределенность и отказоустойчивость** — KV-кластер на Core-нодах обеспечивает устойчивость к отказу отдельных узлов.
- **Иерархия управления** — Root-нода сохраняет высший уровень контроля; оперативное управление делегировано Core-нодам.
- **Автоматизация** — API KV-хранилища позволяет полностью автоматизировать управление сетью.
- **Сохранность данных** — Git-репозиторий гарантирует восстановление сети даже после потери всех оперативных узлов.
- **Консистентность** — KV-хранилище обеспечивает строгую консистентность; [синхронизация]({{< ref "docs/data_storage/sync" >}}) поддерживает согласованность между KV и Git.
