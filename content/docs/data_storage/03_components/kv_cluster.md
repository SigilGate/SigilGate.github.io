---
title: "Кластер Key-Value Хранилища"
---

# 03.1 Кластер Key-Value Хранилища

Распределенное Key-Value (KV) хранилище является основой для оперативного управления и поддержания текущего состояния сети Sigil Gate. Оно обеспечивает быстрый доступ к конфигурациям, статусам узлов и другим динамически изменяющимся параметрам.

## 1. Выбор Технологии (Начальный Этап)

На начальном этапе проекта выбран `etcd` в качестве основного KV-хранилища. `etcd` хорошо зарекомендовал себя в крупных распределенных системах (например, Kubernetes) благодаря своей простоте, высокой производительности и надежности в обеспечении строгой консистентности данных.

## 2. Роль в Архитектуре

KV-кластер служит для хранения всех оперативных данных и текущего состояния сети. Это включает в себя:

*   **Конфигурации узлов:** Актуальные настройки для Root-, Core- и Entry-нод.
*   **Статусы узлов:** Информация о работоспособности, активности и текущих параметрах каждого узла.
*   **Маршруты и параметры соединений:** Динамические пути gRPC, параметры TLS и другая информация, необходимая для установления и поддержания соединений.
*   **Данные пользователей:** Информация о пользователях, их доступах и учетных данных (в хешированном виде).
*   **Топология сети:** Текущие связи между Core-нодами и привязки Entry-нод к Core-нодам.

## 3. Размещение Кластера (Начальный Этап)

На начальном этапе, учитывая небольшой размер сети и для оптимизации ресурсов, кластер `etcd` будет развернут **непосредственно на Core-нодах**. Каждая Core-нода будет являться частью этого распределенного KV-кластера.

### Преимущества такого подхода на начальном этапе:

*   **Минимизация инфраструктуры:** Не требует выделения дополнительных серверов для KV-хранилища.
*   **Упрощение развертывания:** Интеграция `etcd` с Core-нодами уменьшает сложность начальной установки.

### Ограничения и Дальнейшее Развитие:

*   **Связь доступности:** Доступность KV-хранилища напрямую зависит от доступности Core-нод. Сбой Core-ноды может повлиять на весь кластер.
*   **Масштабирование:** По мере роста сети и увеличения нагрузки на Core-ноды, или при необходимости более высокой изоляции, будет рассмотрен переход на выделенный кластер KV-хранилища на отдельных узлах (см. [Дорожная Карта Развития](#05_roadmap)).

## 4. Доступность и Отказоустойчивость

Кластер `etcd` (как и `Consul` в будущем) построен на протоколах консенсуса (например, Raft), что обеспечивает строгую консистентность и высокую доступность. Кластер из нечетного числа узлов (например, 3 или 5) способен пережить отказ до `(N-1)/2` узлов, сохраняя работоспособность.

## 5. Управление Доступом (ACL)

Будет настроена система контроля доступа (ACL) для взаимодействия с KV-кластером:

*   **Root-нода:** Имеет полные права на чтение и запись всех данных в KV-кластере.
*   **Core-ноды:** Имеют права на чтение всех необходимых конфигураций и состояний. Права на запись будут ограничены для оперативных изменений (например, обновление статусов Entry-нод, инициирование ротации путей) и управления пользовательскими данными.
*   **Entry-ноды:** Имеют только права на чтение своих собственных конфигураций и актуальных маршрутов. Им запрещено записывать данные в KV-кластер напрямую.

## 6. API для Автоматизации

KV-хранилище предоставляет удобный API (HTTP/gRPC), который будет использоваться для программного управления сетью. Это обеспечит основу для создания инструментов CLI и будущих веб-интерфейсов, позволяющих автоматизировать все аспекты оперативного управления.