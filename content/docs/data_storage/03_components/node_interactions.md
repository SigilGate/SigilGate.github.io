---
title: "Взаимодействие Узлов с Хранилищами"
---

# 03.3 Взаимодействие Узлов с Хранилищами

Различные типы узлов в сети Sigil Gate имеют специфические роли и, следовательно, различающиеся права доступа и механизмы взаимодействия с распределенным Key-Value (KV) хранилищем и Git-репозиторием.

## 1. Root-нода

Root-нода является центром управления и доверия в сети. Её взаимодействие с хранилищами сосредоточено на критически важных функциях.

*   **Доступ к KV-хранилищу:** Полные права на чтение и запись. Используется для инициализации KV-кластера, внесения глобальных изменений и реагирования на инциденты.
*   **Доступ к Git-репозиторию:** Полные права на чтение и запись. При развертывании или полном восстановлении сети Root-нода извлекает желаемую конфигурацию из Git. Она также может быть задействована для периодической сверки состояния KV-хранилища с Git и фиксации изменений (хотя основная оперативная синхронизация делегируется Core-нодам).
*   **Основные задачи:**
    *   Инициирование развертывания новой сети или полного восстановления.
    *   Управление инфраструктурой открытых ключей (PKI), включая выпуск корневых и промежуточных сертификатов.
    *   Реагирование на критические инциденты, такие как компрометация узлов или отзыв сертификатов.
*   **Особенность:** Root-нода может быть неактивной в течение длительного времени, активируясь только для выполнения своих специфических задач.

## 2. Core-ноды

Core-ноды являются ядром сети и несут основную нагрузку по оперативному управлению и поддержанию её работоспособности. На начальном этапе они также хостят KV-кластер.

*   **Доступ к KV-хранилищу:** Права на чтение всех необходимых конфигураций и оперативных состояний. Ограниченные права на запись для выполнения оперативных изменений, таких как:
    *   Обновление статусов Entry-нод.
    *   Инициирование ротации gRPC-путей для своих Entry-нод.
    *   Управление пользовательскими данными (добавление, изменение, удаление пользователей).
    *   Обновление конфигураций, связанных с их собственным функционированием.
*   **Доступ к Git-репозиторию:** Полные права на запись. Это ключевое отличие от Root-ноды в контексте оперативной синхронизации. Core-ноды отвечают за периодическое сохранение оперативных изменений, произошедших в KV-хранилище, обратно в Git-репозиторий. Это обеспечивает непрерывное версионирование и сохранение актуального состояния сети, даже когда Root-нода неактивна.
*   **Основные задачи:**
    *   Маршрутизация трафика в Интернет.
    *   Управление своими привязанными Entry-нодами.
    *   Выполнение оперативных изменений в сети.
    *   Хостинг узлов KV-кластера (на начальном этапе).
    *   Непрерывная синхронизация оперативного состояния в Git.

## 3. Entry-ноды

Entry-ноды являются периферийными узлами, принимающими клиентские подключения. Их взаимодействие с хранилищами является наиболее ограниченным и сфокусировано на получении своей рабочей конфигурации.

*   **Доступ к KV-хранилищу:** Только права на чтение. Entry-ноды извлекают из KV-кластера необходимую информацию для своей работы, включая:
    *   Свою конфигурацию.
    *   Актуальные gRPC-пути и параметры подключений к Core-нодам.
    *   Данные для аутентификации клиентов.
*   **Доступ к Git-репозиторию:** Отсутствует. Entry-ноды не взаимодействуют напрямую с Git-репозиторием.
*   **Основные задачи:**
    *   Прием клиентских подключений.
    *   Маскировка трафика под легитимную HTTPS-активность.
    *   Перенаправление трафика на Core-ноды.

Такое разделение прав и обязанностей обеспечивает необходимый баланс между централизованным контролем (Root-нода и Git как источник истины) и децентрализованным оперативным управлением (Core-ноды и KV-хранилище), а также минимизирует риски при компрометации периферийных узлов.