---
title: "Репозиторий Git как Источник Истины"
---

# 03.2 Репозиторий Git как Источник Истины

Приватный Git-репозиторий играет критически важную роль в архитектуре хранения данных Sigil Gate, выступая в качестве **единственного источника истины (Source of Truth)** и надежного механизма для бэкапа и восстановления сети. Он хранит *желаемое состояние* всей инфраструктуры и её конфигурации.

## 1. Роль Источника Истины

Git-репозиторий содержит полную, версионированную и аудируемую историю всех конфигураций сети. Это позволяет:

*   **Полное восстановление:** При полной потере или компрометации всей оперативной инфраструктуры (включая KV-кластер), сеть может быть полностью перестроена с нуля, используя данные из Git-репозитория.
*   **Версионирование:** Каждое изменение в конфигурации сети фиксируется как коммит, что позволяет отслеживать эволюцию системы и при необходимости откатываться к предыдущим стабильным состояниям.
*   **Аудит:** История коммитов предоставляет полную картину того, кто, когда и какие изменения вносил в конфигурацию сети, что важно для безопасности и отладки.
*   **Декларативное управление:** Git-репозиторий описывает, *какой должна быть* сеть, а не *как она должна меняться*. Оперативные системы (Root- и Core-ноды) затем стремятся привести реальное состояние сети в соответствие с этим желаемым состоянием.

## 2. Структура Хранения Данных

В Git-репозитории будут храниться структурированные файлы (например, в формате JSON или YAML), описывающие все сущности и их конфигурации. Примеры категорий данных:

*   **Описания узлов:** Детальные конфигурации для Root-, Core- и Entry-нод (без реальных секретов, которые будут генерироваться и управляться через PKI).
*   **Топология:** Статические описания связей между Core-нодами и правила привязки Entry-нод.
*   **Пользователи:** Список зарегистрированных пользователей и их права доступа (без хранения чистых учетных данных).
*   **PKI:** Метаданные о сертификатах, статусы отзыва (CRL).

**Важно:** Git-репозиторий никогда не должен содержать чувствительные данные, такие как приватные ключи, токены или чистые пароли. Управление секретами осуществляется с помощью инфраструктуры открытых ключей (PKI) и динамических механизмов, управляемых через KV-хранилище.

## 3. Взаимодействие с Git-репозиторием

*   **Root-нода:** При развертывании сети или реагировании на крупный инцидент, Root-нода использует Git-репозиторий для получения начальной конфигурации. Она также может быть настроена для синхронизации изменений из Git в KV-хранилище.
*   **Core-ноды:** Для обеспечения непрерывной синхронизации оперативных изменений, все Core-ноды будут иметь доступ к записи в приватный Git-репозиторий. Они будут периодически (или по событию) фиксировать изменения, произошедшие в KV-кластере (например, ротация путей, изменения в статусах Entry-нод), обеспечивая их долгосрочное сохранение и версионирование. Этот механизм гарантирует, что даже при неактивной Root-ноде оперативные изменения не будут потеряны при следующем полном развертывании или синхронизации.

Таким образом, Git-репозиторий является центральным звеном для обеспечения надежности и восстанавливаемости всей сети, дополняя оперативность и консистентность KV-хранилища.